UFINCH: A Method for Simulating and Adjusting Unit Flows in Networks of Channels Described by the NHDPlus Geospatial Framework Using Continuous Daily Flow Data at USGS Streamgages




By David J. Holtschlag




























National Stream Quality Accounting Network Integrated Watershed Studies Group


Preliminary Draft June 2015

U.S Department of the Interior SALLY JEWELL, Secretary

U.S. Geological Survey Suzette M. Kimball, Acting Director



U.S. Geological Survey, Reston, Virginia: 2016

For more information on the USGS—the Federal source for science about the Earth, its natural and living resources, natural hazards, and the environment, visit http://www.usgs.gov or call 1–888–ASK–USGS. For an overview of USGS information products, including maps, imagery, and publications, visit http://www.usgs.gov/pubprod To order this and other USGS information products, visit http://store.usgs.gov


UFINCH software is in the public domain because it contains materials that originally came from the United States Geological Survey, an agency of the United States Department of Interior. For more information, see the official USGS copyright policy at http://www.usgs.gov/visual- id/credit_usgs.html#copyright

Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government. Although this information product, for the most part, is in the public domain, it also may contain copyrighted materials as noted in the text. Permission to reproduce copyrighted items must be secured from the copyright owner.

Contents Abstract	6 Purpose and Scope	6 Methodology	6 Software Installation	9 Data Structure	9 UFINCH Processing and Results	10 Summary and Discussion	28 Acknowledgements	29 References Cited	30


Figures Figure 1.  Main graphical user interface (MainGUI) for UFINCH.	11 Figure 2.  Map of two-digit NHDPlus Hydrologic Regions showing NHDPlus region names for the conterminous US.	12 Figure 3. RegionMapGUI for Hydrologic Region 07 Upper Mississippi showing names of hydrologic subregions, with subregion St. Croix selected.	14 Figure 4.  SubRegionMapGUI for Region 07 Upper Mississippi, Subregion 03 St. Croix, showing flowlines and streamgages. (Streamgages active in water year 2010 are highlighted in dark blue).	14 Figure 5.  Hydrologic subregion 0703 with selected streamgage 05333500 St. Croix River near Danbury, Wisc. and upstream flow network identified.	16 Figure 6.  Inventory of data at the selected streamgage 05333500 St. Croix River near Danbury, Wisc.	18 Figure 7.  Daily and interpolated 15-minute flows at 05333500 St. Croix River near Danbury, Wisc.	18 Figure 8.  Hydrograph and plot of the empirical cumulative distribution function comparing measured and simulated flows at 0533500 St. Croix River near Danbury, WI	21 Figure 9.  Hydrograph and plot of the empirical cumulative distribution function comparing measured with UFINCH simulated and statically adjusted flows at 05332500 Namekagon River near Trego, WI, based on measured flows at 0533500 St. Croix River near Danbury, WI	23 Figure 10. Example input dialog box for model documentation.	24 Figure 11.  Example unit flow output file following static adjustment.	26 Figure 12.Hydrograph and plot of the empirical cumulative distribution function comparing measured with UFINCH simulated and statically adjusted flows at 05331833 Namekagon River at Leonards, WI, based on measured flows at 0533500 St. Croix River near Danbury, WI	27


  Abbreviations AFINCH	Analysis of Flows in Networks of CHannels UFINCH 	Unit Flows In Networks of CHannels HUC	hydrologic unit code NHD	 National Hydrography Dataset NHDPlus	 National Hydrography Dataset with value-added attributes OLS 	ordinary least square PRISM	Parameter-elevation Regressions on Independent Slopes Model R2 	coefficient of determination RMSE 	root mean square error USGS 	U.S. Geological Survey

UFINCH: A Method for Simulating and Adjusting Unit Flows in Networks of Channels Described by the NHDPlus Geospatial Framework Using Continuous Daily Flow Data at USGS Streamgages By David J. Holtschlag Abstract This document describes the main features of the computer application UFINCH (Unit Flows in Networks of Channels) along with results from a sample application.  Using simulation, UFINCH provides a method for estimating unit and daily flows in a stream network defined by the National Hydrography Dataset with Value-Added Attributes (NHDPlus) using daily flows from USGS streamgages.  The simulated flows also can be compared and with, and systematically adjusted, to improve the match with measured upstream flows, thus providing a method for extending streamflow records.  Graphical user interfaces provide an intuitive environment for fast, efficient applications.  UFINCH can be run in the Matlab programming environment or from compiled code on a Microsoft Windows computer. Purpose and Scope The USGS currently monitors streamflow at about 8,000 gages in the United State. The National Hydrography Dataset (NHD, U.S. Geological Survey, 2009) has identified about 4 million streams segments in the nation.  The UFINCH application extends daily streamgage data to unmonitored NHD segments in upstream networks.  UFINCH integrates streamflow data with information in the National Hydrography Dataset containing value-added attributes (NHDPlus, Horizon Systems Corporation, 2014) to make this process fast, efficient, and easy to use.  This document describes the underlying process and key features of the UFINCH software as an aid to applications.  Methodology Streamflow monitored at gaged sites represents catchment runoff that has flowed downstream through a network of channels.  As a first approximation, UFINCH assumes that measured flows are the result of uniform water yields from upstream catchments.  The product of water yields and catchment areas is runoff that flows through stream segments.  Travel times through stream segments to streamgages are considered proportional to flowline lengths and average flow velocities described in NHDPlus.  Using paired streamgages with some temporal overlap in their periods of record, this initial approximation can be refined by accounting for persistent spatial variations in water yields across a basin.  This relation can be applied to simulated flows for the entire period of record available at the downstream gage to refine initial simulations of upstream flows.  Thus, UFINCH provides an application that can extend streamflow information from streamgages both spatially and temporally.  To initiate a UFINCH analysis, a streamgage with continuous flow data is selected as the downstream terminus for a stream network of interest.  This downstream gage is referred to as the base gage, and is used to identify the upstream catchments and interconnected flowlines.  Additional streamgages may occur upstream in the network, and their data provide a basis for comparing and adjusting simulated flows.  Any upstream gages may be referred to as target gages.  Variations in flows at the base gage are expected to reflect variations in average water yields throughout the upstream basin. Particular exceptions to plausible selections of base streamgages are gages located on estuaries or those affected by significant water regulation. A UFINCH analysis proceeds by retrieving daily streamflow values for a base gage.  For U.S. Geological Survey streamgages, an automated process has been developed for retrieving a data inventory from the water data website (waterdata.usgs.gov/nwis/inventory/) and daily flows data from the water services website (waterservices.usgs.gov/nwis/dv/).  The daily flow series are automatically interpolated to 15-minute (unit) value series and divided by drainage area at the base gage to form a time-series of basin-wide-average water yields at unit time steps.  Unit intervals were chosen for UFINCH simulation time steps because the minimum travel time in most stream segments, based on NHDPlus flowline lengths and average flow velocities, is about 15 minutes. UFINCH computes the travel times from the base gage to all upstream catchments and applies the unit water yields to these catchments with appropriate lead times so that flow through the network arrives synchronous the base gage. Spatial variations in water yields commonly occur in natural basins due to persistent differences in the spatial distribution of rainfall, land cover characteristics, or other factors.  Thus, simulations of flow based on average water yields may produce flows that systematically differ from measured flows at some target gages.  UFINCH has two methods for adjusting simulated flows to better match measured flows at an upstream gage.  The static method approximates the discrepancy between (log10 transformed) measured and simulated flows as regression equation with possible linear and quadratic terms of log10  simulated flows.  The predicted values from this regression can sometimes be added to simulated flows to improve the match with measured flows.  The regression method is parsimonious, which may facilitate regionalization, and can readily be applied to simulated values during unmeasured periods at the target gages to synthetically extend streamflow records.  Alternatively, the Empirical Cumulative Distribution Function (ECDF) method provides a more flexible, but less parsimonious, approach than static regression for improving the match between measured and simulated flow characteristics.  The ECDF method computes sample cumulative probabilities and corresponding quantiles for both measured and simulated flows.  This sample has the same length as the number of 15-minute time steps in the simulation (commonly greater than 100,000).  To reduce the size of this set, both measured and simulated quantiles are interpolated at 0.001 intervals of probability from 0 to 1 using the sample estimates.  A set of 1,000 flow ratios is computed by dividing the interpolated measured quantiles by the interpolated simulated quantiles.  To reduce the irregularities in consecutive ratios, a double exponential smoothing filter (Kalekar, 2004) is applied to smooth the sequence.  A smoothing parameter, which is applied to both level and trend components of the filter, is user specified through a linked edit-text field and slider control on the AssessAdjustGUI graphical user interface in UFINCH.  The paired interpolated quantiles of simulated flows and smoothed ratios can be exported to an ASCII file and applied to future simulated flows to provide a flow adjustment during non-overlapping periods of record.  It should be noted that matching the ECDFs for simulated and measured flow does not ensure that the corresponding simulated and measured flow time series will be more correlated.  For example, two white noise series may have the same ECDF, but be uncorrelated. UFINCH is designed for application anywhere within the United States based on medium-resolution NHDPlus geospatial data and daily streamflow data available from the U.S. Geological Survey (USGS).  The extensive geospatial data set supporting the application includes both catchment and streamflow topology, and information on the USGS streamgage network available from the NHDPlus website (http://www.horizon-systems.com/nhdplus/).  Streamflow data can be accessed on demand in UFINCH, provided an internet connection is available.  Software installation, features and operation of the UFINCH application and the supporting data are described in the following paragraphs.

Software Installation UFINCH is written in the Matlab programming language (The MathWorks, 2015a) and uses functions from the Statistics and Machine Learning Toolbox (The MathWorks, 2015a), the Optimization Toolbox (The MathWorks, 2015c), the Mapping Toolbox (The MathWorks, 2015d), as well as the base Matlab functions.  Computers equipped with this suite of software can run UFINCH from the source code.  Alternatively, UFINCH can be run on 64-bit Windows-based computers without the Matlab programming environment by use of an executable version compiled under Matlab R2015a.  The file UFinch_Installer_web.exe file, shared though the Google drive, is designed to facilitate this process, but requires admin privileges for software installation.  Once initiated, the installer should automatically download the 2015a version of the Matlab Compiler Runtime (MCR) program from the MathWorks website, unless it already is installed.  The MCR translates Matlab code to binary instructions that Windows can execute.  Once the MCR file is installed, the executable UFINCH application, UFinch.exe and updates compiled under Matlab 2015a (also shared through the Google drive), can be run from the Windows command line or desktop icon.  Data Structure In addition to the UFINCH software, geographic information and flow data are needed to support the application.  Given the extensive geographic information system (GIS) data involved in UFINCH applications, the GIS data has been partitioned by hydrologic regions, as defined in NHDPlus.  These regional units generally correspond to 21 USGS Hydrologic Regions (U.S. Geological Survey, 2008, http://water.usgs.gov/GIS/regions.html), although some of the regions have been subdivided in NHDPlus to form 23 regions (http://www.horizon- systems.com/NHDPlus/NHDPlusV2_data.php).  In particular, Region 03 South Atlantic-Gulf has been partitioned into North, South, and West divisions, and Region 10 Missouri has been partitioned into Upper and Lower divisions.  Also, Region 13 Rio Grande, as defined by NHDPlus, has been extended into Mexico. Preparation of NHDPlus data for Alaska (Region 19) is in progress. UFINCH GIS data is partitioned into folders consistent with this NHDPlus GIS data structure. UFINCH uses a relative folder structure for locating and storing files.  The UFINCH application is expected to be run from the folder ..\UFinch\UWork, where “..\” can be any folder on a computer system.  An additional folder, ..\UFinch\HR00\GIS, is needed to provide supporting GIS data. This data has two basic types: GIS data specific to individual hydrologic units, and a national streamgaging dataset.  Any or all of the 2-digit hydrologic region [xx] data sets can be loaded in subfolders under ..\UFinch\HR00\GIS\. These subfolders are named {HR01, HR02, HR03N, HR03S, HR03W,...,HR22} corresponding to the NHDPlus convention, and can be downloaded from the Google drive. In addition, the streamgage shapefile set also should be downloaded and stored under the GIS folder: ..\UFinch\HR00\GIS\Streamgage\.  In the first analysis of any two-digit hydrologic region [xx], UFINCH will create a new subfolder named ..\UFinch\HR[xx]\GIS\.  Region-specific GIS data will be copied to this subfolder from the ..\UFinch\HR00\GIS\HR[xx]\ folder.  In addition, a FlowData subfolder will be created along with subfolders for storing unit and daily simulated and measured flows.  Subsequent analysis will use the region- specific folder to access GIS and flow data. The region-specific data include (1) binary and supporting files of the boundary of the hydrologic region (two- digit) along with subregional (four-digit) boundaries in the shapefile set HUC02wHUC04.*, where the ‘*’ refers to a set of common filename extensions commonly associated with shapefiles {shp, sbn, sbx, shx, prj, dbf}, (2) binary and supporting files in flowline shapefile set NHDFlowline.*, (3) text files NHDFlowlineVAA.txt and PlusFlow.txt containing value added attributes describing flowline connectivity, flowline lengths and corresponding catchment drainage areas, and (4) text file EROM_MA0001.txt of average flow velocity for individual flowlines identified uniquely by ComID.  Nationwide GIS data for the USGS streamgage locations and attributes are stored in the binary and supporting shapefile set StreamGageEvent.*.  These GIS shapefile set for all US streamgages are stored in folder ..\HR00\GIS\Streamgage\.  UFINCH Processing and Results If the UFINCH software is properly installed and the folder ‘HR[xx]’, for the region of interest, and the Streamgage folder and expected contents are in place under ..\UFinch\HR00\GIS\, the user can initiate a UFINCH analysis.  After launching UFINCH, the main GUI is displayed (Figure 1).  The main GUI provides access to much of the functionality of UFINCH, including selection of the 2- digit hydrologic region for study, selection of base and target streamgages, and specification of the simulation period.  There is a button on the main GUI labelled “Display Map of Hydrologic Regions in Conterminous US” that displays a (nonclickable) map of NHDPlus hydrologic regions (Figure 2) for reference.

Figure 1.  Main graphical user interface (MainGUI) for UFINCH.


Figure 2.  Map of two-digit NHDPlus Hydrologic Regions showing NHDPlus region names for the conterminous US.

Once a two-digit [xx] named region is selected from a drop-down list in the upper left-hand corner of the MainGUI, UFINCH will determine if the corresponding folder ..\UFinch\HR[xx] exists.  If the folder does not exist, UFINCH will prompt for permission to create the folder structure, and copy regional GIS data from ..\UFinch\HR00\GIS\HR[xx] to populate ..\UFinch\HR[xx]. Otherwise, data in the existing regional folder will be used. Following selection of the two-digit region, the RegionMapGUI will be displayed showing the names of all hydrologic subregions (Figure 3).  The user may then select a 4-digit subregion within this region by left clicking on the RegionMapGUI, which causes the corresponding subregion map component to be highlighted in blue.  A right click ends the selection process .  The RegionMapGUI then closes, and a new SubRegionMapGUI is displayed (Figure 4) showing the outline of the selected subregion.  The user then can click the buttons labelled “Display Flowlines” and “Display Streamgages” to show NHDPlus flowlines and streamgages within the selected subregion on the SubRegionMapGUI.  To facilitate flowline and streamgage file selection, UFINCH will launch an open file dialog box and prompt for the expected file name of the corresponding coverage in the expected directory location.  For standard applications, the user can merely accept the default file location by clicking the “Open” button on the dialog box. Otherwise, the user can navigate the open file dialog box to the location of the custom user-created shapefile. Flowline shapefiles provide detailed geometry for tens of thousands of flowlines in a region.  These files tend to be large, greater than 50 megabytes, and require about a minute to read and display.  A message dialog box is displayed indicating this expected time requirement, and is closed when the process is complete.  Prior to selecting a base streamgage, the user may use the “Specify Water Year” edit text box to enter a year.  Those triangular streamgage symbols displayed on the SubRegionMapGUI are greyed out if the streamgage was not active in the specified year (Figure 4).



Figure 3. RegionMapGUI for Hydrologic Region 07 Upper Mississippi showing names of hydrologic subregions, with subregion St. Croix selected.

Figure 4.  SubRegionMapGUI for Region 07 Upper Mississippi, Subregion 03 St. Croix, showing flowlines and streamgages. (Streamgages active in water year 2010 are highlighted in dark blue).


The SubRegionMapGUI can be used to identify streamgages and record characteristics by left clicking on the triangular symbols representing streamgages.  Both blue highlighted and greyed-out symbols are clickable. Attributes of clicked streamgage symbols are displayed on the MainGUI in the “Identify Streamgage Attributes” panel.  Attributes include streamgage number and name, first and last date of data collection, latitude, longitude, drainage area, and the ComID, which uniquely identifies the flowline (stream segment) on which the streamgage is located.  Once the desired base streamgage is identified, the base gage can be selected for analysis by use of the “Select Base Streamgage” button in the “Select Streamgage as Network Base” panel. Selection of the base gage highlights the streamgage and flowline network upstream of the gage on the SubRegionMapGUI (Figure 5).  Also, fields on the MainGUI in the “Select Streamgage as Network Base” panel are populated, including those identifying the streamgage and the number of flowlines in the network.  Also, the drop down list in the mainGUI “Select Target Streamgage” panel is populated with gage numbers for all streamgages at or upstream from the selected base gage.  The static text field labeled “Number” displays the number of gages at or upstream from the base gage in the network.



Figure 5.  Hydrologic subregion 0703 with selected streamgage 05333500 St. Croix River near Danbury, Wisc. and upstream flow network identified.

The use may then select the “Read 15-min Flows” button on the MainGUI to retrieve or access unit flow data.  Once this button is selected, UFINCH will prompt for the expected name of the flow data file in the expected directory. For example, if base gage 05333500 is selected in the St. Croix subregion of the Upper Mississippi region (HR07), UFINCH will prompt for a data file 05333500*.uFloMea in the folder ..\UFinch\HR07\FlowData\ Measured\Unit.  If no data file has been previously retrieved for this streamgage, the user can select the 'Cancel' button in the get file dialog box.  This action launches a question dialog box with buttons labelled “Retrieve Data,” “Reselect Gage,”, and “Cancel.”  Selecting the “Retrieve Data” button will initiate an input dialog box for the station number (that is populated with the base gage number) and two boxes for the start and end date of data retrieval.  This date range can be based on an inventory of available data that is initiated from UFINCH and automatically displayed in a browser window returned from an NWIS query (Figure 6).  The specified streamgage and date range are used in a water services data (http://waterservices.usgs.gov/) retrieval to obtain daily flows. The daily flows are interpolated to 15-minute increments for simulation and are overlain on one or more hydrographs of measured flows in a new figure window.  Multiple hydrographs, and corresponding data files, are sometimes returned to span all the continuous periods of record at the streamgage.   Separate data files are created for each period of continuous record, and are labelled to identify the beginning and ending dates of the period.  For example, data retrieval for 05331833 from Oct. 1, 1997 to Sept. 30, 2014, created two data files named 05331833_1997Oct01_2001Sep30.uFloMea and 05331833_2005May02_2014Sep30.uFloMea were created and stored in folder ..\UFinch\HR07\FlowData\Measured\Unit\.  Once a unit flow file is generated, the user can select the data file for the period of interest using the Open button on the file dialog box.  This selection causes UFINCH to read in the unit flow data. A hydrograph of this data is displayed in a new figure window, and attributes of the flow data are shown in the panel labeled “Retrieve Flow Data Inventory and Daily Flows” panel in the upper right corner of the MainGUI.




Figure 6.  Inventory of data at the selected streamgage 05333500 St. Croix River near Danbury, Wisc.

Figure 7.  Daily and interpolated 15-minute flows at 05333500 St. Croix River near Danbury, Wisc.

Travel times through the network are computed as the product of flowline length and average flow velocity defined in NHDPlus.  Flow velocities in NHDPlus reflect particle velocities in streams.  The user can proportionately adjust NHDPlus flow velocities to better reflect the speed of a wave in an open channel (wave celerity), which potentially improves the match between measured and simulated hydrographs.   In particular, the user may specify a multiplier to adjust mean flow velocities in each flowline by use of controls in the panel named “Compute Travel Times in Streamgage Network.”  The default of 1 can be changed by adjusting the linked slider/edit-text box to a preferred value. Based on limited testing, a value of 2.5 often produces a closer match between simulated and measured flows at the base gage than a value of 1.0.  The default value of 1 may produce simulated hydrographs that are damped with respect to measured (interpolated) values.  The adjusted velocities in UFINCH are not intended to reflect information on particle velocities in streams. Once the multiplier is specified, travel times in the network can be computed by selecting the “Compute Travel Times” button.  A summary of minimum and maximum travel times in the network in 15-min time increment and days are tabulated in the “Travel Time Statistics” table to the right of this button.  Travel times determine the apparent lead time needed for water to travel from a catchment to the base gage.  Basin water yields are computed for each time step on the basis of interpolated flows at the base gage.  Basin yields are applied to upstream catchments with time leads designed so that corresponding flows appear to arrive synchronously at the base gage. The simulation period can be specified in the “Compute Unit Flows in Streamgage Network” panel.  Start and end-time values are pre-specified in the editable text boxes based on the period of record in the flow file.  The number of computational time steps for the simulation is displayed in a static text box to the right of the simulation period. Computational requirements are proportional to the product of the number of time steps and the number of flowlines, which is displayed in the panel labelled “Number of Flowlines in the Gage Network”.  For example, the simulation of the highlighted network in Figure 5, which is composed of 781 flowlines, for 140,161 time steps from Oct. 1, 2010 to Sept. 30, 2014, or about 10 million flowline- time steps, was completed in 6.5 minutes on a conventional workstation using a single processor.  A wait bar is displayed during the simulation to indicate the temporal progress of the computations.  Finally, the user may select a target streamgage to compare measured and simulated flows.  The streamgage numbers in the drop down list shown in the “Select Target Streamgage” panel include all streamgages at or upstream from the base gage.  Selecting a target streamgage from this list highlights the corresponding gage on the SubRegionMapGUI.  To confirm the connectivity of the catchments and the flow network for the base gage, the user may wish to initially specify the target gage as the base gage. Connectivity would be confirmed if the average simulated flow is consistent with the average measured flow.  Alternatively, if simulated flows are consistently less than measured flows, drainage from some catchment areas may not be represented at the base gage.  On possible reason for this difficulty is that UFINCH may not have been correctly interpreted the network topology.  Selecting the “Assess Fit and Adjust Flow” button in the “Base and Target Gages” panel on the MainGUI will initiate an input file dialog box defaulting to a file name associated with the target gage number, commonly an eight-digit value, [yyyyyyyy], with an extension for unit flows measured at the target gage in folder ..\UFinch\HR[xx]\FlowData\Measured\Unit\.  For example, if target gage 05333500 St. Croix River near Danbury, WI, were selected for the target site, the default file name would be 05333500*.uFloMea.  The asterisk embedded in the file name would enable display of files with unit flows at the selected site with continuous flows during multiple time periods.  Again, if no data files had been previously retrieved for the target site, the user could press “Cancel” in the input file dialog box.  Cancelling would again initiate a question dialog box to facilitate retrieving daily flows and interpolating them to unit values. A data inventory would be retrieved to help the user specify the period of record.  Results for the example scenario involving gage 05333500 are displayed on the AssessAdjustGUI  (Figure 8).  Measured and simulated flows are over plotted on hydrographs and ECDFs in this figure.  In this scenario, careful inspection is required to confirm that both measured and simulated flows are displayed because of their close correspondence.  These results appear to confirm the connectivity of the flow network and that flow is conserved in UFINCH.  Controls in the “Hydrographs and ECDF Series” panel can be used to clear or select sets of flow series for display.  Slider controls in the “Scale Hydrograph with Time Domain Limits” can be used to zoom in on the time axis of the hydrograph.  In this case, there is little potential for improving the match between simulated and measured flows by applying adjustments.  Selecting the “Clear and Exit” button in the lower right hand corner of the AssessAdjustGUI will close the figure and return the user to the MainGUI.

Figure 8.  Hydrograph and plot of the empirical cumulative distribution function comparing measured and simulated flows at 0533500 St. Croix River near Danbury, WI

Once the connectivity of the flow network is confirmed, the user may wish to compare simulated and measured flows at one or more upstream gages.  This process will be illustrated with streamgage 05332500 Namekagon River near Trego, WI, and 05331833 Namekagon River at Leonards, WI.  Selecting stream gage number 05332500 in the “Select Target Streamgage” panel displays characteristics of the streamgage and flow record in the “Streamgage Attributes” panel on the MainGUI. The period of record at 05332500 extends from 1928 to 2014, thus providing a temporal overlap with the simulated period.  The drainage area at the gage is 488 square miles, or about 31 percent of the area at the base gage.  Selecting the “Assess Fit and Adjust Flow” button will again provide the opportunity to use an existing unit flow data file or retrieve daily flows.  In this scenario, a data file was created from data retrieved for the period Oct. 1, 1990, to Sep. 30, 2014 (05332500_1990Oct_2014Sep30.uFloMea).  Selecting this file initiates the AssessAdjustGUI show in Figure 8. In this comparison, measured and simulated flows at 05332500 are quite distinct.  The hydrograph indicates that measured flows tend to be more variable than simulated flows.  The ECDF indicates that at lower flows, simulated values commonly underestimate measured flows, but that at higher flows simulated values overestimate measured flows.  Based on this comparison, a static regression model was developed to adjust simulated flows to better match measured flows.  In particular, a constant and linear term was selected from the “Static Adjustment” panel to estimate this adjustment. Estimates of the magnitudes and uncertainties of this model are displayed in the table to the right of the selected parameters.  Due to the high autocorrelation expected for unit flows in residual series, the conventional t-Statistics and p- Values shown for the corresponding parameters in the model have only marginal utility.  The R2 value displayed in the panel indicates that the estimated linear function of log10 simulated flows explains about 38 percent of the variability in the residuals between log10 measured and log10 simulated flows. Adjusting the simulated flows by the regression model appears to improve the match in hydrographs and reduce the bias in the ECDFs.  Given the observed improvement in fit, the user may wish to document the model and save the adjusted flow information.  To document the model, the user can apply controls in the “Write Selected Unit Flows to File” panel.  In this case, the “Statically Adjusted Flows” radio button might be selected.  The “Document Model” button launches an input dialog box with editable fields prepopulated with base and target gage information (Figure 9).  Selecting the “Write Selected Flows” button launches an input file dialog box with a default file name in an expected folder location.  In this example, default folder is ..\UFinch\HR07\FlowData\Simulated\Unit\ and default file is 05332500_05333500_2010Oct01_2014 Sep27.uFloStt to indicate that this is unit flows (uFlo) that have been statically (Stt) adjusted for target gage 05332500 conditioned on flow at base gage 05333500 from Oct. 1, 2010 to Sep. 27, 2014.



Figure 9.  Hydrograph and plot of the empirical cumulative distribution function comparing measured with UFINCH simulated and statically adjusted flows at 05332500 Namekagon River near Trego, WI, based on measured flows at 0533500 St. Croix River near Danbury, WI

  Figure 10.  Example input dialog box for model documentation.

The contents of the output flow file are shown in Figure 10.  The file begins with header information that is delimited by an opening “/*” and closing “*/”, which provides documentation for the analysis but is ignored by UFINCH when the file is read in for possible future simulations.  The “Clear and Exit” button on the lower right hand corner of the AssessAdjustGUI returns control to the MainGUI. The second upstream target gage selected for analysis was 05331833 Namekagon River at Leonards, WI.  The streamgage measures flow from a basin of 126 mi2, or about 8 percent of the flow at the base gage.  Although the hydrograph indicates a generally consistent pattern between variations in simulated and measured flows, the ECDF shows that simulated flows are generally biased below measured flows, with this tendency decrease with higher flows.  A quadratic regression was used to adjust simulated flows and effectively compensate for this bias.  In general the hydrograph shows that the adjustment generally improved the match between match statically adjusted simulated flows and measured flows.  The robust parameter estimation technique, rather than Ordinary Least Squares (OLS), was selected for this analysis by use of controls in the radio button panel labeled “Estimation Technique.”  In particular, the robust parameters provided an adjustment that improved the match between measured and statically adjusted flows at higher flow magnitudes.  Model document and adjusted simulated unit flow may output as discussed previously before selecting the “Clear and Exit” button on the AssessAdjustGUI to return to the MainGUI. The MainGUI provides several minor features that may be of interest.  The button labelled “Generate Equations” lists the time-indexed equations that UFINCH uses to route flow from the upper catchments downstream through the flow network to the outlet at the base gage.  The output is listed to the computer console.  This listing may have utility in identifying UFINCH coding limitations for unusual network configurations, or NHDPlus network anomalies when flow is apparently not conserved.  The “Aggregate” button in the “Unit to Daily Values for All ComIDs” panel aggregates unit values to daily flows for all flowlines in the network.  These simulated daily flows can saved to an ASCII output file by use of the labeled “Save” button for further analysis.  The aggregation may require several moments to complete the computation for large networks and extended simulation periods.  Unit flows for all flowlines also can be saved in Matlab binary format by selecting the “Save All Unit Flows as MLBinary,” although the large size of this binary tends limit its perceived utility. The “Exit” button on the MainGUI will provide end the application and exit to the operating system.  Before existing, the Microsoft notepad application will be launched to display the contents of an automatically generated, time-stamped log file entitled “uFinchSummary[yyyymmmdd_HHMM].txt. This file will contain model documentation for any models documented during the session.  Finally, UFINCH will display a question dialog box requesting to close any open figures.

  Figure 11.  Example unit flow output file following static adjustment.



Figure 12.Hydrograph and plot of the empirical cumulative distribution function comparing measured with UFINCH simulated and statically adjusted flows at 05331833 Namekagon River at Leonards, WI, based on measured flows at 0533500 St. Croix River near Danbury, WI

Summary and Discussion UFINCH can be used to simulate daily and unit flows in networks of streams based on the NHDPlus geospatial data and USGS daily streamflow data.  Interactive GUIs help make the UFINCH process intuitive, flexible, and efficient.  Simulation results at streamgages are readily accessible and interpretable.  The process for computing flows is highly automated, which allows for generation of flow information quickly and efficiently.  The standard mode (the presented paired-gage approach) of a UFINCH analysis is expected to have applications to (1) hydrographic comparison and quality-assuring streamflow records, (2) streamflow record extension at an upstream gage using the overlapping period of record at a base and target gage to assess fit and develop any needed adjustment, and extension using adjusted long-term simulated flows from the base gage, and (3) developing long-term daily flow series for analysis of impact of hydrologic alterations.  A progressive mode UFINCH analysis would extend the standard mode by integrating the measured period of record at the upstream gage with simulated, and perhaps adjusted, flow information to form a hybrid (measured plus simulated) unit flow series.  The initial target gage, augmented with the hybrid series, would then be used as the base gage to continue UFINCH simulation for the upstream flow network.  Further, an inferential mode of analysis is envisioned in which the implications of any static flow adjustment at a target gage would be applied to intervening flows between the base and target gages.  The inferential mode could be extended to simultaneous resolution of unit flows in a multigage network. Future UFINCH enhancements could provide access to simulated unit flows at all flowlines in the network.  Currently, individual flowlines on the SubRegionMapGUI are clickable if flowlines are the active layer, rather than the streamgage layer. The “Active Layer” radio button panel on the MainGUI is used to select the active layer, which defaults to the streamgage layer.  Characteristics of the selected flowlines can currently be displayed in the “Flowline Attributes” panel on the MainGUI.  A feature for accessing, plotting, and exporting the simulated unit flows may be helpful, although additional feature layers, such as major roads, may be needed to facilitate flowline selection.  Another feature that may have utility in future versions of UFINCH would be the ability to use discrete flow measurements at miscellaneous sites to assess and adjust simulated flows. In particular, the static regression model for adjusting simulated flows is parsimonious, which would thus allow the 1-4 needed model parameters to be estimated from a relatively small number of discrete measurements.  Such relatively limited data requirements could be helpful in confirming and improving model simulations for ecological investigations on small streams and other applications.  Integration of UFINCH with AFINCH (Holtschlag, 2009) would eliminate the assumption of uniform water yields underlying UFINCH.  In particular, AFINCH (Analysis of Flows in Networks of Channels) uses the same NHDPlus network of catchments and flowlines and streamgage network as UFINCH to compute monthly flows.  AFINCH conditions the spatial distribution of monthly water-yields on monthly climatic data (PRISM Climate Group 2013), including precipitation and temperature, and selected land-use, land-cover characteristics using a constrained regression approach.  Within the U.S. Great Lakes area, monthly AFINCH water yields area precomputed for all NHDPlus catchments from 1951 to 2012 (Luukkonen and others, 2015).  Finally, adjustment of measured flows at base or target streamgages with water use data may facilitate the application of UFINCH to regulated streams.

Acknowledgements The author would like to acknowledge the contributions of Paul Capel, team lead of the USGS NAWQA Integrated Watershed Studies Group, for supporting refinements that significantly contributed to the usability of the UFINCH application.  Also, Howard Reeves, Research Hydrologist, USGS Michigan Water Science Center, significantly contributed to the development of both AFINCH and UFINCH by coding the graphical user interface used to select four- digit hydrologic subregions.  In addition, the author is indebted to colleague reviewers and those who provided final editing and formatting for publication.

References Cited Holtschlag, D.J., 2009, Application guide for AFINCH (Analysis of Flows In Networks of CHannels) described by NHDPlus: U.S. Geological Survey Scientific Investigations Report 2009–5188, 106 p. (Also available at http://pubs. usgs.gov/sir/2009/5188/.) Horizon Systems Corporation, 2014, NHDPlusV2 flow table navigator toolbar, accessed May 27, 2014, at http:// www.horizon-systems.com/NHDPlus/NHDPlusV2_tools. php#NHDPlusV2. Kalekar, P.S., Time series forecasting using Holt-Winters exponential smoothing, Kanwal Rekhi School of Information Technology, Bombay, India, 13 p., accessed June 10, 2015, at http://www.it.iitb.ac.in/~praj/acads/ seminar/04329008_ExponentialSmoothing.pdf Luukkonen, C.L., Holtschlag, D.J., Reeves, H.W., Hoard, C.J., and Fuller, L.M., 2015, Estimation of monthly water yields and flows for 1951–2012 for the United States portion of the Great Lakes Basin with AFINCH: U.S. Geological Survey Scientific Investigations Report 2014–5192, 83 p, http://dx.doi.org/10.3133/sir20145192. The MathWorks, 2015a, Matlab Programming Fundamentals, R2015a: Natick, MA, 1064 p., accessed June 11, 2015, at http://in.mathworks.com/help/pdf_doc/matlab/matlab_prog.pdf The MathWorks, 2015b, Statistics and Machine Learning Toolbox User’s Guide: R2015a, Natick, MA, 6682 p., accessed June 11, 2015 at http://www.mathworks.com/help/pdf_doc/stats/stats.pdf The MathWorks, 2015c, Optimization Toolbox User’s Guide, R2015a: Natick, MA, 780 p., accessed June 11, 2015, at http://www.mathworks.com/help/pdf_doc/optim/optim_tb.pdf The MathWorks, 2015d, Mapping Toolbox User’s Guide, R2015a: Natick, MA, 836 p., accessed June 11, 2015, at http://www.mathworks.com/help/pdf_doc/map/map_ug.pdf PRISM Climate Group, 2013, United States average mean annual precipitation and air temperature: Northwest Alliance for Computational Science and Engineering at Oregon State University, accessed August 1, 2013, at http://www. ocs.orst.edu/prism U.S. Geological Survey, 2008, Hydrologic unit maps—What are hydrologic units?, accessed November 24, 2008, at http://water.usgs.gov/GIS/huc.html. U.S. Geological Survey, 2009, National Hydrography Dataset, available at http://nhd.usgs.gov/ U.S. Geological Survey, 2014, Water Webserver Team, Hydrologic Unit Map (Based on Data from USGS Water- Supply Paper 2294), accessed June 11, 2015, at http://water.usgs.gov/GIS/regions.html

